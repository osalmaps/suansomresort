<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Suan Som Resort & Restaurant</title>
    <style>
        /* General Body Styles */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f4f4;
            color: #333;
            line-height: 1.6;
        }

        /* Header Styles */
        .header {
            background-color: #333;
            color: #fff;
            padding: 1rem 0;
            text-align: center;
        }

        .header h1 {
            margin: 0;
        }

        /* Navigation Styles */
        .navbar {
            background-color: #444;
            color: #fff;
            padding: 0.5rem 0;
            text-align: center;
        }

        .navbar a {
            color: #fff;
            text-decoration: none;
            padding: 0 15px;
            display: inline-block;
        }

        .navbar a:hover {
            background-color: #555;
        }

        /* Main Content Area */
        .container {
            width: 80%;
            margin: auto;
            overflow: hidden;
            padding: 20px 0;
        }

        /* Section Styles */
        .section {
            background: #fff;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .section h2 {
            color: #007bff;
            text-align: center;
            margin-bottom: 20px;
        }

        .section p {
            text-align: justify;
            margin-bottom: 10px;
        }

        .section ul {
            list-style: none;
            padding: 0;
            text-align: center;
        }

        .section ul li {
            background: #e9e9e9;
            margin: 5px 0;
            padding: 10px;
            border-radius: 5px;
            display: inline-block;
            margin: 5px;
        }

        /* Button Styles */
        .button {
            display: inline-block;
            background: #007bff;
            color: #fff;
            padding: 10px 20px;
            border-radius: 5px;
            text-decoration: none;
            text-align: center;
            margin-top: 10px;
            transition: background-color 0.3s ease;
            cursor: pointer;
            border: none;
        }

        .button:hover {
            background: #0056b3;
        }

        /* Gallery Styles */
        .gallery-images {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            padding: 20px 0;
        }

        .image-container {
            position: relative;
            overflow: hidden;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            cursor: pointer;
        }

        .image-container img {
            width: 100%;
            display: block;
            border-radius: 8px;
            transition: transform 0.3s ease;
        }

        .image-container:hover img {
            transform: scale(1.05);
        }

        .image-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            color: #fff;
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 0;
            transition: opacity 0.3s ease;
            border-radius: 8px;
            text-align: center;
            padding: 10px;
            box-sizing: border-box;
        }

        .image-container:hover .image-overlay {
            opacity: 1;
        }

        .image-overlay p {
            margin: 0;
            font-size: 0.9em;
        }

        /* Footer Styles */
        .footer {
            background-color: #333;
            color: #fff;
            text-align: center;
            padding: 1rem 0;
            position: relative;
            bottom: 0;
            width: 100%;
        }

        /* Popup Container */
        .popup {
            display: none; /* Hidden by default */
            position: fixed; /* Stay in place */
            z-index: 100; /* Sit on top */
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%); /* Center the popup */
            width: 90%; /* Occupy full width */
            max-width: 800px; /* Max width */
            height: auto;
            max-height: 90vh; /* Max height for scrollable content */
            background-color: #fefefe;
            padding: 20px;
            border: 1px solid #888;
            border-radius: 10px;
            box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2), 0 6px 20px 0 rgba(0,0,0,0.19);
            flex-direction: column; /* For vertical alignment */
            align-items: center;
            opacity: 0; /* Initial state for fade-in */
            visibility: hidden; /* Initial state for fade-in */
            transition: opacity 0.5s ease-in-out, visibility 0.5s ease-in-out;
            box-sizing: border-box; /* Include padding in width/height */
        }

        .popup-content {
            width: 100%;
            padding: 10px 0;
            overflow-y: auto; /* Enable scrolling for content */
            flex-grow: 1; /* Allows content to take available space */
        }

        .popup h2 {
            color: #007bff;
            text-align: center;
            margin-top: 0;
            margin-bottom: 20px;
        }

        .popup h3 {
            color: #555;
            margin-top: 20px;
            margin-bottom: 10px;
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
        }

        .popup ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .popup ul li {
            padding: 8px 0;
            border-bottom: 1px dotted #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .popup ul li:last-child {
            border-bottom: none;
        }

        /* Close Button */
        .close {
            color: #aaa;
            position: absolute;
            top: 10px;
            right: 20px;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            z-index: 101; /* Ensure it's above content */
        }

        .close:hover,
        .close:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }

        /* Overlay */
        .overlay {
            display: none; /* Hidden by default */
            position: fixed; /* Stay in place */
            z-index: 99; /* Sit on top of page content */
            left: 0;
            top: 0;
            width: 100%; /* Full width */
            height: 100%; /* Full height */
            background-color: rgba(0,0,0,0.7); /* Black w/ opacity */
            opacity: 0; /* Initial state for fade-in */
            visibility: hidden; /* Initial state for fade-in */
            transition: opacity 0.5s ease-in-out, visibility 0.5s ease-in-out;
        }

        /* Menu Tabs within Popups */
        .menu-tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
            width: 100%; /* Ensure tabs take full width */
        }

        .tab-button {
            padding: 10px 20px;
            margin: 0 5px;
            border: none;
            background-color: #e0e0e0;
            cursor: pointer;
            border-radius: 5px;
            transition: background-color 0.3s ease;
        }

        .tab-button.active {
            background-color: #007bff;
            color: white;
        }

        .tab-button:hover:not(.active) {
            background-color: #d0d0d0;
        }

        .menu-section {
            display: none; /* Hidden by default */
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 8px;
            margin-top: 10px;
            background-color: #fff;
        }

        .menu-section.active {
            display: block; /* Show active section */
        }

        .submenu-buttons {
            display: flex;
            flex-wrap: wrap; /* Allow buttons to wrap to next line */
            justify-content: center;
            gap: 10px; /* Space between buttons */
            margin-top: 15px;
            margin-bottom: 15px;
        }

        .sub-button {
            background-color: #28a745;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
            transition: background-color 0.3s ease;
        }

        .sub-button:hover {
            background-color: #218838;
        }

        /* Modal for full image view */
        .modal {
            display: none; /* Hidden by default */
            position: fixed; /* Stay in place */
            z-index: 101; /* Sit on top of everything */
            padding-top: 50px; /* Location of the box */
            left: 0;
            top: 0;
            width: 100%; /* Full width */
            height: 100%; /* Full height */
            overflow: auto; /* Enable scroll if needed */
            background-color: rgba(0,0,0,0.9); /* Black w/ opacity */
            flex-direction: column; /* For centering content */
            align-items: center;
            justify-content: center;
            opacity: 0; /* Initial state for fade-in */
            visibility: hidden; /* Initial state for fade-in */
            transition: opacity 0.5s ease-in-out, visibility 0.5s ease-in-out;
        }

        .modal-content {
            margin: auto;
            display: block;
            width: 80%;
            max-width: 700px;
            height: auto; /* Maintain aspect ratio */
            max-height: 80%; /* Limit height to prevent image from going off screen */
            object-fit: contain; /* Ensure the whole image is visible */
        }

        #modal-caption {
            margin: auto;
            display: block;
            width: 80%;
            max-width: 700px;
            text-align: center;
            color: #ccc;
            padding: 10px 0;
            height: 150px; /* Adjust height as needed */
            font-size: 1.2em;
            overflow-y: auto; /* Allow scrolling for long captions */
        }

        /* Modal Navigation Buttons */
        .modal-nav {
            position: absolute;
            top: 50%;
            width: 100%;
            display: flex;
            justify-content: space-between;
            transform: translateY(-50%);
            z-index: 102; /* Above modal content */
        }

        .modal-nav-btn {
            background-color: rgba(0,0,0,0.5);
            color: white;
            border: none;
            padding: 15px;
            cursor: pointer;
            font-size: 2em;
            user-select: none; /* Prevent text selection */
            transition: background-color 0.3s ease;
        }

        .modal-nav-btn:hover:not(:disabled) {
            background-color: rgba(0,0,0,0.8);
        }

        .modal-nav-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .modal-nav-btn.prev {
            border-top-right-radius: 5px;
            border-bottom-right-radius: 5px;
            margin-left: 0; /* Ensure no margin pushes it */
        }

        .modal-nav-btn.next {
            border-top-left-radius: 5px;
            border-bottom-left-radius: 5px;
            margin-right: 0; /* Ensure no margin pushes it */
        }

        /* New CSS for dynamic menu content placeholder */
        .menu-content-placeholder {
            padding: 10px; /* Adjust as needed */
            max-height: calc(90vh - 150px); /* Max height relative to popup height minus title/padding */
            overflow-y: auto;
        }

        /* Responsive adjustments */
        @media screen and (max-width: 768px) {
            .container {
                width: 95%;
            }

            .tab-button {
                flex-grow: 1;
                margin: 5px 2px;
            }

            .submenu-buttons {
                flex-direction: column;
                align-items: stretch;
            }

            .sub-button {
                width: 100%;
                margin: 5px 0;
            }

            .popup {
                width: 95%;
                padding: 15px;
            }

            .modal-content {
                width: 95%;
            }

            #modal-caption {
                width: 95%;
                font-size: 1em;
            }
        }
    </style>
</head>
<body>

    <div class="header">
        <h1>Suan Som Resort & Restaurant</h1>
    </div>

    <div class="navbar">
        <a href="#about">About Us</a>
        <a href="#restaurant" onclick="openPopup('restaurant-popup')">Restaurant</a>
        <a href="#rooms">Rooms</a>
        <a href="#facilities">Facilities</a>
        <a href="#contact">Contact</a>
    </div>

    <div class="container">
        <div id="about" class="section">
            <h2>About Us</h2>
            <p>Welcome to Suan Som Resort & Restaurant, a serene oasis nestled in the heart of Thailand. We offer a perfect blend of traditional Thai hospitality and modern comforts, ensuring a memorable stay for all our guests.</p>
            <p>Our resort boasts lush gardens, a sparkling swimming pool, and direct access to tranquil natural surroundings. Whether you're seeking a relaxing getaway or an adventurous exploration of the local culture, Suan Som is your ideal destination.</p>
            <div class="gallery-images">
                <div class="image-container">
                    <img src="images/resort_view.jpg" alt="Aerial view of the resort" onclick="openModal(this)">
                    <div class="image-overlay"><p>An aerial view showcasing the expansive beauty of Suan Som Resort.</p></div>
                </div>
                <div class="image-container">
                    <img src="images/garden.jpg" alt="Lush resort garden" onclick="openModal(this)">
                    <div class="image-overlay"><p>Stroll through our beautifully manicured tropical gardens.</p></div>
                </div>
                <div class="image-container">
                    <img src="images/pool.jpg" alt="Swimming pool area" onclick="openModal(this)">
                    <div class="image-overlay"><p>Relax by our refreshing swimming pool, perfect for a sunny afternoon.</p></div>
                </div>
            </div>
        </div>

        <div id="restaurant" class="section">
            <h2>Our Restaurant</h2>
            <p>Savor authentic Thai cuisine and a selection of international dishes at our on-site restaurant. Our chefs use fresh, local ingredients to create delightful culinary experiences.</p>
            <button class="button" onclick="openPopup('restaurant-popup')">View Our Menu</button>
        </div>

        <div id="rooms" class="section">
            <h2>Rooms & Accommodation</h2>
            <p>Our comfortable and elegantly designed rooms offer a peaceful retreat. Each room is equipped with amenities to ensure a pleasant stay, including air conditioning, private bathrooms, and scenic views.</p>
            <div class="gallery-images">
                <div class="image-container">
                    <img src="images/room_interior.jpg" alt="Comfortable room interior" onclick="openModal(this)">
                    <div class="image-overlay"><p>Step into the comfort and elegance of our spacious rooms.</p></div>
                </div>
                <div class="image-container">
                    <img src="images/balcony_view.jpg" alt="Room balcony view" onclick="openModal(this)">
                    <div class="image-overlay"><p>Enjoy breathtaking views from your private balcony.</p></div>
                </div>
                <div class="image-container">
                    <img src="images/bed.jpg" alt="Cozy bed in a room" onclick="openModal(this)">
                    <div class="image-overlay"><p>Sink into the plush comfort of our beds after a day of adventure.</p></div>
                </div>
            </div>
        </div>

        <div id="facilities" class="section">
            <h2>Facilities</h2>
            <p>Suan Som Resort offers a range of facilities to enhance your stay, including a fitness center, spa services, and a tour desk to help you explore the local attractions.</p>
            <div class="gallery-images">
                <div class="image-container">
                    <img src="images/spa.jpg" alt="Resort spa" onclick="openModal(this)">
                    <div class="image-overlay"><p>Indulge in relaxation at our tranquil spa.</p></div>
                </div>
                <div class="image-container">
                    <img src="images/gym.jpg" alt="Fitness center" onclick="openModal(this)">
                    <div class="image-overlay"><p>Stay active in our well-equipped fitness center.</p></div>
                </div>
                <div class="image-container">
                    <img src="images/reception.jpg" alt="Reception area" onclick="openModal(this)">
                    <div class="image-overlay"><p>Our friendly reception staff are ready to assist you.</p></div>
                </div>
            </div>
        </div>

        <div id="contact" class="section">
            <h2>Contact Us</h2>
            <p>We look forward to welcoming you to Suan Som Resort & Restaurant. For reservations or inquiries, please contact us:</p>
            <p><strong>Phone:</strong> +66 123 456 789</p>
            <p><strong>Email:</strong> info@suansomresort.com</p>
            <p><strong>Address:</strong> 123 Main Road, Khon Kaen, Thailand</p>
            <div class="image-container">
                <img src="images/map.jpg" alt="Resort map" onclick="openModal(this)">
                <div class="image-overlay"><p>Find us easily on the map.</p></div>
            </div>
        </div>
    </div>

    <div id="restaurant-popup" class="popup">
        <span class="close" onclick="closePopup('restaurant-popup')">×</span>
        <h2>Our Restaurant</h2>
        <div class="popup-content">
            <div class="menu-tabs">
                <button class="tab-button active" onclick="showMenuSection('food-menu-section', this, 'restaurant-popup')">Food Menu</button>
                <button class="tab-button" onclick="showMenuSection('drink-menu-section', this, 'restaurant-popup')">Drink Menu</button>
            </div>

            <div id="food-menu-section" class="menu-section active">
                <h3>Food Menu</h3>
                <p>Explore our culinary delights:</p>
                <div class="submenu-buttons">
                    <button class="sub-button" onclick="openPopup('thai-food-popup')">Thai Food</button>
                    <button class="sub-button" onclick="openPopup('farang-food-popup')">Farang Food</button>
                    <button class="sub-button" onclick="openPopup('desserts-popup')">Desserts</button>
                    <button class="sub-button" onclick="openPopup('special-food-popup')">This Week's Special</button>
                </div>
                <div class="image-container">
                    <img src="images/padthai.jpg" alt="Variety of Thai dishes" onclick="openModal(this)">
                    <div class="image-overlay"><p>A glimpse into our delicious range of Thai cuisine.</p></div>
                </div>
            </div>

            <div id="drink-menu-section" class="menu-section">
                <h3>Drink Menu</h3>
                <p>Quench your thirst with our wide selection:</p>
                <div class="submenu-buttons">
                    <button class="sub-button" onclick="openPopup('soft-drinks-popup')">Soft Drinks</button>
                    <button class="sub-button" onclick="openPopup('local-beers-popup')">Local Beers</button>
                    <button class="sub-button" onclick="openPopup('alcoholic-drinks-popup')">Alcoholic Beverages</button>
                    <button class="sub-button" onclick="openPopup('thai-bar-drinks-popup')">Thai Bar Drinks</button>
                </div>
                <div class="image-container">
                    <img src="images/beergarden.jpg" alt="Refreshing drinks" onclick="openModal(this)">
                    <div class="image-overlay"><p>Enjoy a refreshing drink at our resort's friendly bar.</p></div>
                </div>
            </div>
        </div>
    </div>

    <div id="thai-food-popup" class="popup">
        <span class="close" onclick="closePopup('thai-food-popup')">×</span>
        <h2 id="thai-food-title"></h2>
        <div class="popup-content">
            <div id="thai-food-content" class="menu-content-placeholder"></div>
        </div>
    </div>

    <div id="farang-food-popup" class="popup">
        <span class="close" onclick="closePopup('farang-food-popup')">×</span>
        <h2 id="farang-food-title"></h2>
        <div class="popup-content">
            <div id="farang-food-content" class="menu-content-placeholder"></div>
        </div>
    </div>

    <div id="desserts-popup" class="popup">
        <span class="close" onclick="closePopup('desserts-popup')">×</span>
        <h2 id="desserts-title"></h2>
        <div class="popup-content">
            <div id="desserts-content" class="menu-content-placeholder"></div>
        </div>
    </div>

    <div id="special-food-popup" class="popup">
        <span class="close" onclick="closePopup('special-food-popup')">×</span>
        <h2 id="special-food-title"></h2>
        <div class="popup-content">
            <div id="special-food-content" class="menu-content-placeholder"></div>
        </div>
    </div>

    <div id="soft-drinks-popup" class="popup">
        <span class="close" onclick="closePopup('soft-drinks-popup')">×</span>
        <h2 id="soft-drinks-title"></h2>
        <div class="popup-content">
            <div id="soft-drinks-content" class="menu-content-placeholder"></div>
        </div>
    </div>

    <div id="local-beers-popup" class="popup">
        <span class="close" onclick="closePopup('local-beers-popup')">×</span>
        <h2 id="local-beers-title"></h2>
        <div class="popup-content">
            <div id="local-beers-content" class="menu-content-placeholder"></div>
        </div>
    </div>

    <div id="alcoholic-drinks-popup" class="popup">
        <span class="close" onclick="closePopup('alcoholic-drinks-popup')">×</span>
        <h2 id="alcoholic-drinks-title"></h2>
        <div class="popup-content">
            <div id="alcoholic-drinks-content" class="menu-content-placeholder"></div>
        </div>
    </div>

    <div id="thai-bar-drinks-popup" class="popup">
        <span class="close" onclick="closePopup('thai-bar-drinks-popup')">×</span>
        <h2 id="thai-bar-drinks-title"></h2>
        <div class="popup-content">
            <div id="thai-bar-drinks-content" class="menu-content-placeholder"></div>
        </div>
    </div>

    <div id="modal" class="modal">
        <span class="close" onclick="closeModal()">×</span>
        <img class="modal-content" id="modal-img">
        <div id="modal-caption"></div>
        <div class="modal-nav">
            <button class="modal-nav-btn prev" id="modal-prev" onclick="showPrevImage()">&#10094;</button>
            <button class="modal-nav-btn next" id="modal-next" onclick="showNextImage()">&#10095;</button>
        </div>
    </div>


    <div class="footer">
        <p>© 2024 Suan Som Resort & Restaurant. All rights reserved.</p>
    </div>

    <div class="overlay"></div>

    <script>
// public/index.html (inside <script> tag) or public/script.js

let menuData;

async function fetchMenuData() {
    try {
        const response = await fetch('/api/menu');
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        menuData = await response.json();
        console.log('Menu data fetched successfully:', menuData);

    } catch (error) {
        console.error('Failed to fetch menu data:', error);
        alert('Could not load menu data. Please refresh the page or try again later.');
    }
}

// Global constant for transition duration (matches CSS)
const TRANSITION_DURATION_MS = 1000;

// Global variables for gallery functionality
let currentGalleryImages = [];
let currentImageIndex = -1;

// Get modal elements once
const modal = document.getElementById('modal');
const modalImg = document.getElementById('modal-img');
const modalCaption = document.getElementById('modal-caption');
const modalPrevBtn = document.getElementById('modal-prev');
const modalNextBtn = document.getElementById('modal-next');
const overlay = document.querySelector('.overlay');

// --- Gallery/Swipe functionality variables ---
let touchStartX = 0;
let touchEndX = 0;
const SWIPE_THRESHOLD = 50;

function hideAllImmediately() {
    const allPopups = document.querySelectorAll('.popup');
    allPopups.forEach(p => {
        p.style.opacity = '0';
        p.style.visibility = 'hidden';
        p.style.display = 'none';
    });

    modal.style.opacity = '0';
    modal.style.visibility = 'hidden';
    modal.style.display = 'none';

    overlay.style.opacity = '0';
    overlay.style.visibility = 'hidden';
    overlay.style.display = 'none';

    currentGalleryImages = [];
    currentImageIndex = -1;
    disableGalleryControls();
    removeGalleryEventListeners();
}

function showMenuSection(sectionId, clickedButton, parentPopupId) {
    const parentPopup = document.getElementById(parentPopupId);
    const tabButtons = parentPopup.querySelectorAll('.tab-button');
    tabButtons.forEach(button => {
        button.classList.remove('active');
    });

    const menuSections = parentPopup.querySelectorAll('.menu-section');
    menuSections.forEach(section => {
        section.classList.remove('active');
    });

    clickedButton.classList.add('active');
    document.getElementById(sectionId).classList.add('active');
}

function generateMenuContent(popupId, menuCategoryData) {
    const contentDiv = document.getElementById(popupId.replace('-popup', '-content'));
    if (!contentDiv) {
        console.error(`Content div not found for popup: ${popupId}`);
        return;
    }

    contentDiv.innerHTML = '';

    const titleElement = document.getElementById(popupId.replace('-popup', '-title'));
    if (titleElement) {
        titleElement.textContent = menuCategoryData.title;
    }

    if (menuCategoryData.description) {
        const p = document.createElement('p');
        p.textContent = menuCategoryData.description;
        contentDiv.appendChild(p);
    }

    if (menuCategoryData.sections) {
        menuCategoryData.sections.forEach(section => {
            if (section.heading) {
                const h3 = document.createElement('h3');
                h3.textContent = section.heading;
                contentDiv.appendChild(h3);
            }
            const ul = document.createElement('ul');
            section.items.forEach(item => {
                const li = document.createElement('li');
                let itemText = item.name;
                if (item.price !== null) {
                    itemText += ` - ${item.price} Baht`;
                }
                li.textContent = itemText;
                ul.appendChild(li);
            });
            contentDiv.appendChild(ul);
        });
    } else if (menuCategoryData.items) {
        const ul = document.createElement('ul');
        menuCategoryData.items.forEach(item => {
            const li = document.createElement('li');
            let itemText = item.name;
            if (item.price !== null) {
                itemText += ` - ${item.price}`;
            }
            li.innerHTML = itemText;
            ul.appendChild(li);
        });
        contentDiv.appendChild(ul);
    }

    if (menuCategoryData.imageSrc) {
        const imageContainer = document.createElement('div');
        imageContainer.classList.add('image-container');

        const img = document.createElement('img');
        img.src = menuCategoryData.imageSrc;
        img.alt = menuCategoryData.imageAlt;
        img.onclick = () => openModal(img);

        const imageOverlay = document.createElement('div');
        imageOverlay.classList.add('image-overlay');
        const overlayP = document.createElement('p');
        overlayP.textContent = menuCategoryData.imageOverlayText;
        imageOverlay.appendChild(overlayP);

        imageContainer.appendChild(img);
        imageContainer.appendChild(imageOverlay);
        contentDiv.appendChild(imageContainer);
    }

    if (menuCategoryData.footer) {
        const p = document.createElement('p');
        p.innerHTML = menuCategoryData.footer;
        contentDiv.appendChild(p);
    }
}

const originalOpenPopup = openPopup;

openPopup = function(popupId) {
    if (!menuData) {
        console.warn('Menu data not yet loaded. Please wait and try again.');
        return;
    }

    switch (popupId) {
        case 'thai-food-popup':
            generateMenuContent(popupId, menuData.food.thaiFood);
            break;
        case 'farang-food-popup':
            generateMenuContent(popupId, menuData.food.farangFood);
            break;
        case 'desserts-popup':
            generateMenuContent(popupId, menuData.food.desserts);
            break;
        case 'special-food-popup':
            generateMenuContent(popupId, menuData.food.specialFood);
            break;
        case 'soft-drinks-popup':
            generateMenuContent(popupId, menuData.drinks.softDrinks);
            break;
        case 'local-beers-popup':
            generateMenuContent(popupId, menuData.drinks.localBeers);
            break;
        case 'alcoholic-drinks-popup':
            generateMenuContent(popupId, menuData.drinks.alcoholicDrinks);
            break;
        case 'thai-bar-drinks-popup':
            generateMenuContent(popupId, menuData.drinks.thaiBarDrinks);
            break;
        default:
            break;
    }
    originalOpenPopup(popupId);
};

function openModal(clickedElementOrSrc) {
    hideAllImmediately();

    let initialSrc = '';
    let clickedImageElement = null;

    if (typeof clickedElementOrSrc === 'string') {
        initialSrc = clickedElementOrSrc;
        currentGalleryImages = [{ src: initialSrc, alt: '' }];
        currentImageIndex = 0;
    } else {
        clickedImageElement = clickedElementOrSrc;
        initialSrc = clickedImageElement.src;

        const parentGallery = clickedImageElement.closest('.gallery-images');

        if (parentGallery) {
            currentGalleryImages = Array.from(parentGallery.querySelectorAll('.image-container img'));
            currentImageIndex = currentGalleryImages.indexOf(clickedImageElement);
        } else {
            currentGalleryImages = [{ src: initialSrc, alt: clickedImageElement.alt }];
            currentImageIndex = 0;
        }
    }

    modalImg.src = initialSrc;
    modalImg.alt = currentGalleryImages[currentImageIndex]?.alt || 'Image';
    modalCaption.textContent = currentGalleryImages[currentImageIndex]?.alt || '';
    modalCaption.style.display = modalCaption.textContent ? 'block' : 'none';

    modal.style.display = 'flex';
    overlay.style.display = 'block';

    setTimeout(() => {
        modal.style.opacity = '1';
        modal.style.visibility = 'visible';
        overlay.style.opacity = '1';
        overlay.style.visibility = 'visible';
    }, 10);

    setupGalleryControls();
}

function setupGalleryControls() {
    if (currentGalleryImages.length > 1) {
        modalPrevBtn.style.display = 'block';
        modalNextBtn.style.display = 'block';
        updateGalleryButtons();

        modalPrevBtn.onclick = showPrevImage;
        modalNextBtn.onclick = showNextImage;
        document.addEventListener('keydown', handleKeyPress);

        modalImg.addEventListener('touchstart', handleTouchStart, { passive: true });
        modalImg.addEventListener('touchmove', handleTouchMove, { passive: true });
        modalImg.addEventListener('touchend', handleTouchEnd);
    } else {
        disableGalleryControls();
    }
}

function disableGalleryControls() {
    if (modalPrevBtn) modalPrevBtn.style.display = 'none';
    if (modalNextBtn) modalNextBtn.style.display = 'none';
    if (modalCaption) modalCaption.style.display = 'none';
}

function updateModalImage() {
    modalImg.src = currentGalleryImages[currentImageIndex].src;
    modalImg.alt = currentGalleryImages[currentImageIndex].alt;
    modalCaption.textContent = currentGalleryImages[currentImageIndex].alt;
    modalCaption.style.display = modalCaption.textContent ? 'block' : 'none';

    updateGalleryButtons();
}

function updateGalleryButtons() {
    modalPrevBtn.disabled = currentImageIndex === 0;
    modalNextBtn.disabled = currentImageIndex === currentGalleryImages.length - 1;
}

function showNextImage() {
    if (currentImageIndex < currentGalleryImages.length - 1) {
        currentImageIndex++;
        updateModalImage();
    }
}

function showPrevImage() {
    if (currentImageIndex > 0) {
        currentImageIndex--;
        updateModalImage();
    }
}

function handleKeyPress(event) {
    if (modal.style.display === 'flex' && modal.style.visibility === 'visible') {
        if (event.key === 'ArrowRight') {
            showNextImage();
        } else if (event.key === 'ArrowLeft') {
            showPrevImage();
        }
    }
}

function handleTouchStart(event) {
    touchStartX = event.touches[0].clientX;
}

function handleTouchMove(event) {
    touchEndX = event.touches[0].clientX;
}

function handleTouchEnd() {
    const swipeDistance = touchEndX - touchStartX;

    if (currentGalleryImages.length > 1) {
        if (swipeDistance > SWIPE_THRESHOLD) {
            showPrevImage();
        } else if (swipeDistance < -SWIPE_THRESHOLD) {
            showNextImage();
        }
    }
    touchStartX = 0;
    touchEndX = 0;
}

function closeModal() {
    modal.style.opacity = '0';

    setTimeout(() => {
        modal.style.display = 'none';
        modal.style.visibility = 'hidden';
        closeOverlayIfNoPopupsOpen();

        currentGalleryImages = [];
        currentImageIndex = -1;
        disableGalleryControls();
        removeGalleryEventListeners();
    }, TRANSITION_DURATION_MS);
}

function closePopup(popupId) {
    const popup = document.getElementById(popupId);
    popup.style.opacity = '0';

    setTimeout(() => {
        popup.style.display = 'none';
        popup.style.visibility = 'hidden';
        closeOverlayIfNoPopupsOpen();
    }, TRANSITION_DURATION_MS);
}

function closeAllPopups() {
    const allPopups = document.querySelectorAll('.popup');
    let anyElementStartedToClose = false;

    allPopups.forEach(p => {
        if (p.style.display === 'flex' || p.style.visibility === 'visible') {
            p.style.opacity = '0';
            anyElementStartedToClose = true;
        }
    });

    if (modal.style.display === 'flex' || modal.style.visibility === 'visible') {
        modal.style.opacity = '0';
        anyElementStartedToClose = true;
    }

    if (anyElementStartedToClose && (overlay.style.display === 'block' || overlay.style.visibility === 'visible')) {
        overlay.style.opacity = '0';
    }

    setTimeout(() => {
        allPopups.forEach(p => {
            p.style.display = 'none';
            p.style.visibility = 'hidden';
        });
        modal.style.display = 'none';
        modal.style.visibility = 'hidden';
        closeOverlayIfNoPopupsOpen();

        currentGalleryImages = [];
        currentImageIndex = -1;
        disableGalleryControls();
        removeGalleryEventListeners();
    }, TRANSITION_DURATION_MS);
}

function closeOverlayIfNoPopupsOpen() {
    const allPopups = document.querySelectorAll('.popup');

    let anyPopupStillOpen = false;
    allPopups.forEach(p => {
        if (p.style.display === 'flex' || p.style.visibility === 'visible') {
            anyPopupStillOpen = true;
        }
    });
    const isModalStillOpen = (modal.style.display === 'flex' || modal.style.visibility === 'visible');

    if (!anyPopupStillOpen && !isModalStillOpen) {
        overlay.style.display = 'none';
        overlay.style.visibility = 'hidden';
    }
}

function removeGalleryEventListeners() {
    document.removeEventListener('keydown', handleKeyPress);
    modalImg.removeEventListener('touchstart', handleTouchStart);
    modalImg.removeEventListener('touchmove', handleTouchMove);
    modalImg.removeEventListener('touchend', handleTouchEnd);
}

document.addEventListener('DOMContentLoaded', () => {
    fetchMenuData();

    if (overlay) {
        overlay.addEventListener('click', closeAllPopups);
    }
    if (modalPrevBtn) modalPrevBtn.addEventListener('click', showPrevImage);
    if (modalNextBtn) modalNextBtn.addEventListener('click', showNextImage);
});
        // Start of new dynamic menu data and functions
        

        /**
         * Generates and injects menu content into a popup.
         * @param {string} popupId - The ID of the popup div (e.g., 'thai-food-popup').
         * @param {object} menuCategoryData - The data object for the specific menu category (e.g., menuData.food.thaiFood).
         */
        function generateMenuContent(popupId, menuCategoryData) {
            const contentDiv = document.getElementById(popupId.replace('-popup', '-content'));
            if (!contentDiv) {
                console.error(`Content div not found for popup: ${popupId}`);
                return;
            }

            // Clear previous content
            contentDiv.innerHTML = '';

            // Set the title
            const titleElement = document.getElementById(popupId.replace('-popup', '-title'));
            if (titleElement) {
                titleElement.textContent = menuCategoryData.title;
            }

            // Add description if it exists
            if (menuCategoryData.description) {
                const p = document.createElement('p');
                p.textContent = menuCategoryData.description;
                contentDiv.appendChild(p);
            }

            // Generate menu sections
            if (menuCategoryData.sections) {
                menuCategoryData.sections.forEach(section => {
                    if (section.heading) {
                        const h3 = document.createElement('h3');
                        h3.textContent = section.heading;
                        contentDiv.appendChild(h3);
                    }
                    const ul = document.createElement('ul');
                    section.items.forEach(item => {
                        const li = document.createElement('li');
                        let itemText = item.name;
                        if (item.price !== null) { // Only add price if it's not null (for examples)
                            itemText += ` - ${item.price} Baht`;
                        }
                        li.textContent = itemText;
                        ul.appendChild(li);
                    });
                    contentDiv.appendChild(ul);
                });
            } else if (menuCategoryData.items) { // For simpler lists like desserts or specials
                const ul = document.createElement('ul');
                menuCategoryData.items.forEach(item => {
                    const li = document.createElement('li');
                    let itemText = item.name;
                    if (item.price !== null) {
                        itemText += ` - ${item.price}`;
                    }
                    li.innerHTML = itemText; // Use innerHTML for potential bold in special
                    ul.appendChild(li);
                });
                contentDiv.appendChild(ul);
            }

            // Add image container for special food and thai bar drinks if applicable
            if (menuCategoryData.imageSrc) {
                const imageContainer = document.createElement('div');
                imageContainer.classList.add('image-container');

                const img = document.createElement('img');
                img.src = menuCategoryData.imageSrc;
                img.alt = menuCategoryData.imageAlt;
                img.onclick = () => openModal(img); // Re-attach click to open modal

                const imageOverlay = document.createElement('div');
                imageOverlay.classList.add('image-overlay');
                const overlayP = document.createElement('p');
                overlayP.textContent = menuCategoryData.imageOverlayText;
                imageOverlay.appendChild(overlayP);

                imageContainer.appendChild(img);
                imageContainer.appendChild(imageOverlay);
                contentDiv.appendChild(imageContainer);
            }

            // Add footer if it exists
            if (menuCategoryData.footer) {
                const p = document.createElement('p');
                p.innerHTML = menuCategoryData.footer; // Use innerHTML for italics
                contentDiv.appendChild(p);
            }
        }

        // Store a reference to the original openPopup function
        const originalOpenPopup = openPopup;

        // Override the global openPopup function
        openPopup = function(popupId) {
            // Before opening, check if it's a menu popup and load its data
            switch (popupId) {
                case 'thai-food-popup':
                    generateMenuContent(popupId, menuData.food.thaiFood);
                    break;
                case 'farang-food-popup':
                    generateMenuContent(popupId, menuData.food.farangFood);
                    break;
                case 'desserts-popup':
                    generateMenuContent(popupId, menuData.food.desserts);
                    break;
                case 'special-food-popup':
                    generateMenuContent(popupId, menuData.food.specialFood);
                    break;
                case 'soft-drinks-popup':
                    generateMenuContent(popupId, menuData.drinks.softDrinks);
                    break;
                case 'local-beers-popup':
                    generateMenuContent(popupId, menuData.drinks.localBeers);
                    break;
                case 'alcoholic-drinks-popup':
                    generateMenuContent(popupId, menuData.drinks.alcoholicDrinks);
                    break;
                case 'thai-bar-drinks-popup':
                    generateMenuContent(popupId, menuData.drinks.thaiBarDrinks);
                    break;
                default:
                    // No dynamic content generation needed for this popup
                    break;
            }
            // Call the original openPopup function to handle display logic
            originalOpenPopup(popupId);
        };
        // End of new dynamic menu data and functions


        // Global constant for transition duration (matches CSS)
        const TRANSITION_DURATION_MS = 1000; // Adjusted back to 0.5s for modal fade

        // Global variables for gallery functionality
        let currentGalleryImages = []; // Stores the <img> elements of the current gallery
        let currentImageIndex = -1; // Stores the index of the currently displayed image

        // Get modal elements once
        const modal = document.getElementById('modal');
        const modalImg = document.getElementById('modal-img');
        const modalCaption = document.getElementById('modal-caption');
        const modalPrevBtn = document.getElementById('modal-prev');
        const modalNextBtn = document.getElementById('modal-next');
        const overlay = document.querySelector('.overlay');

        // --- Gallery/Swipe functionality variables ---
        let touchStartX = 0;
        let touchEndX = 0;
        const SWIPE_THRESHOLD = 50; // Minimum pixels to count as a swipe


        // Function to close all currently visible popups and the modal immediately without waiting for fade-out.
        // This is for use when opening a new one, to ensure only one is active at a time.
        function hideAllImmediately() {
            const allPopups = document.querySelectorAll('.popup');
            allPopups.forEach(p => {
                p.style.opacity = '0';
                p.style.visibility = 'hidden';
                p.style.display = 'none';
            });

            modal.style.opacity = '0';
            modal.style.visibility = 'hidden';
            modal.style.display = 'none';

            overlay.style.opacity = '0';
            overlay.style.visibility = 'hidden';
            overlay.style.display = 'none';

            // Reset gallery state when hiding all
            currentGalleryImages = [];
            currentImageIndex = -1;
            disableGalleryControls(); // Ensure buttons are disabled and hidden
            removeGalleryEventListeners(); // Clean up listeners
        }

        function showMenuSection(sectionId, clickedButton, parentPopupId) {
            const parentPopup = document.getElementById(parentPopupId);
            const tabButtons = parentPopup.querySelectorAll('.tab-button');
            tabButtons.forEach(button => {
                button.classList.remove('active');
            });

            const menuSections = parentPopup.querySelectorAll('.menu-section');
            menuSections.forEach(section => {
                section.classList.remove('active');
            });

            clickedButton.classList.add('active');
            document.getElementById(sectionId).classList.add('active');
        }

        /**
         * Opens the image modal, optionally initializing it as a gallery.
         * @param {HTMLElement|string} clickedElementOrSrc - The <img> element that was clicked, or just the image source string.
         */
        function openModal(clickedElementOrSrc) {
            hideAllImmediately(); // Hide any currently open popups/modal instantly

            let initialSrc = '';
            let clickedImageElement = null;

            if (typeof clickedElementOrSrc === 'string') {
                // If only a source is passed (e.g., from a sub-button like "Driveway View")
                initialSrc = clickedElementOrSrc;
                // Since we don't have a direct element, we can't build a dynamic gallery for this specific click.
                // So, we'll treat it as a single image view for now.
                currentGalleryImages = [{ src: initialSrc, alt: '' }]; // Create a temporary single-image gallery
                currentImageIndex = 0;
            } else {
                // If the <img> element itself was clicked (e.g., from gallery-images)
                clickedImageElement = clickedElementOrSrc;
                initialSrc = clickedImageElement.src;

                // Find the parent .gallery-images container
                const parentGallery = clickedImageElement.closest('.gallery-images');

                if (parentGallery) {
                    // Populate currentGalleryImages with all <img> elements in that container
                    currentGalleryImages = Array.from(parentGallery.querySelectorAll('.image-container img'));
                    currentImageIndex = currentGalleryImages.indexOf(clickedImageElement);
                } else {
                    // Fallback for individual images not in a gallery-images container
                    currentGalleryImages = [{ src: initialSrc, alt: clickedImageElement.alt }];
                    currentImageIndex = 0;
                }
            }

            // Set initial image and caption
            modalImg.src = initialSrc;
            modalImg.alt = currentGalleryImages[currentImageIndex]?.alt || 'Image'; // Use alt from stored element, or default
            modalCaption.textContent = currentGalleryImages[currentImageIndex]?.alt || ''; // Use alt as caption

            // Show caption only if there's content
            modalCaption.style.display = modalCaption.textContent ? 'block' : 'none';

            // Display modal and overlay with fade-in
            modal.style.display = 'flex';
            overlay.style.display = 'block';

            setTimeout(() => {
                modal.style.opacity = '1';
                modal.style.visibility = 'visible';
                overlay.style.opacity = '1';
                overlay.style.visibility = 'visible';
            }, 10);

            // Setup gallery controls and event listeners
            setupGalleryControls();
        }

        // Sets up click listeners for modal nav buttons and keyboard/touch events
        function setupGalleryControls() {
            if (currentGalleryImages.length > 1) {
                modalPrevBtn.style.display = 'block';
                modalNextBtn.style.display = 'block';
                updateGalleryButtons(); // Ensure correct initial state

                // Add event listeners (ensure they are not added multiple times)
                modalPrevBtn.onclick = showPrevImage;
                modalNextBtn.onclick = showNextImage;
                document.addEventListener('keydown', handleKeyPress);

                // Touch swipe listeners
                modalImg.addEventListener('touchstart', handleTouchStart, { passive: true });
                modalImg.addEventListener('touchmove', handleTouchMove, { passive: true });
                modalImg.addEventListener('touchend', handleTouchEnd);
            } else {
                disableGalleryControls(); // Hide buttons if only one image
            }
        }

        // Disables and hides gallery navigation buttons and caption
        function disableGalleryControls() {
            if (modalPrevBtn) modalPrevBtn.style.display = 'none';
            if (modalNextBtn) modalNextBtn.style.display = 'none';
            if (modalCaption) modalCaption.style.display = 'none'; // Hide caption for single images
        }

        // Updates the source and alt of the modal image, and enables/disables nav buttons
        function updateModalImage() {
            modalImg.src = currentGalleryImages[currentImageIndex].src;
            modalImg.alt = currentGalleryImages[currentImageIndex].alt;
            modalCaption.textContent = currentGalleryImages[currentImageIndex].alt;
            modalCaption.style.display = modalCaption.textContent ? 'block' : 'none';

            updateGalleryButtons();
        }

        // Enables/disables prev/next buttons based on current index
        function updateGalleryButtons() {
            modalPrevBtn.disabled = currentImageIndex === 0;
            modalNextBtn.disabled = currentImageIndex === currentGalleryImages.length - 1;
        }

        // Shows the next image in the current gallery
        function showNextImage() {
            if (currentImageIndex < currentGalleryImages.length - 1) {
                currentImageIndex++;
                updateModalImage();
            }
        }

        // Shows the previous image in the current gallery
        function showPrevImage() {
            if (currentImageIndex > 0) {
                currentImageIndex--;
                updateModalImage();
            }
        }

        // Handles keyboard arrow key navigation
        function handleKeyPress(event) {
            if (modal.style.display === 'flex' && modal.style.visibility === 'visible') { // Only active if modal is open
                if (event.key === 'ArrowRight') {
                    showNextImage();
                } else if (event.key === 'ArrowLeft') {
                    showPrevImage();
                }
            }
        }

        // Touch swipe handlers
        function handleTouchStart(event) {
            touchStartX = event.touches[0].clientX;
        }

        function handleTouchMove(event) {
            touchEndX = event.touches[0].clientX;
        }

        function handleTouchEnd() {
            const swipeDistance = touchEndX - touchStartX;

            if (currentGalleryImages.length > 1) { // Only allow swipe if it's a gallery
                if (swipeDistance > SWIPE_THRESHOLD) {
                    // Swipe right (prev image)
                    showPrevImage();
                } else if (swipeDistance < -SWIPE_THRESHOLD) {
                    // Swipe left (next image)
                    showNextImage();
                }
            }
            // Reset touch coordinates
            touchStartX = 0;
            touchEndX = 0;
        }


        // Closes the full image modal with fade
        function closeModal() {
            modal.style.opacity = '0'; // Start fade out

            setTimeout(() => {
                modal.style.display = 'none';
                modal.style.visibility = 'hidden';
                closeOverlayIfNoPopupsOpen(); // Check if the overlay should also be hidden

                // Reset gallery state and remove listeners
                currentGalleryImages = [];
                currentImageIndex = -1;
                disableGalleryControls(); // Ensure controls are hidden after closing
                removeGalleryEventListeners();
            }, TRANSITION_DURATION_MS);
        }

        // Closes any general popup with fade
        // This function is still needed by individual close buttons on popups
        // The global 'openPopup' function has been modified, but this one remains
        // as it's directly called by the 'x' close button.
        function closePopup(popupId) {
            const popup = document.getElementById(popupId);
            popup.style.opacity = '0'; // Start fade out

            setTimeout(() => {
                popup.style.display = 'none';
                popup.style.visibility = 'hidden';
                closeOverlayIfNoPopupsOpen(); // Check if the overlay should also be hidden
            }, TRANSITION_DURATION_MS);
        }

        // Central function to close all open popups and the modal with fade
        // This function is for when you explicitly want to fade-out the current item(s)
        function closeAllPopups() {
            const allPopups = document.querySelectorAll('.popup');
            let anyElementStartedToClose = false;

            allPopups.forEach(p => {
                if (p.style.display === 'flex' || p.style.visibility === 'visible') {
                    p.style.opacity = '0';
                    anyElementStartedToClose = true;
                }
            });

            if (modal.style.display === 'flex' || modal.style.visibility === 'visible') {
                modal.style.opacity = '0';
                anyElementStartedToClose = true;
            }

            if (anyElementStartedToClose && (overlay.style.display === 'block' || overlay.style.visibility === 'visible')) {
                overlay.style.opacity = '0';
            }

            setTimeout(() => {
                allPopups.forEach(p => {
                    p.style.display = 'none';
                    p.style.visibility = 'hidden';
                });
                modal.style.display = 'none';
                modal.style.visibility = 'hidden';
                closeOverlayIfNoPopupsOpen();

                // Reset gallery state and remove listeners
                currentGalleryImages = [];
                currentImageIndex = -1;
                disableGalleryControls();
                removeGalleryEventListeners();
            }, TRANSITION_DURATION_MS);
        }

        // Helper function to determine if the overlay should be hidden
        function closeOverlayIfNoPopupsOpen() {
            const allPopups = document.querySelectorAll('.popup');

            let anyPopupStillOpen = false;
            allPopups.forEach(p => {
                if (p.style.display === 'flex' || p.style.visibility === 'visible') {
                    anyPopupStillOpen = true;
                }
            });
            const isModalStillOpen = (modal.style.display === 'flex' || modal.style.visibility === 'visible');

            if (!anyPopupStillOpen && !isModalStillOpen) {
                overlay.style.display = 'none';
                overlay.style.visibility = 'hidden';
            }
        }

        // Removes keyboard and touch listeners to prevent conflicts when modal is closed
        function removeGalleryEventListeners() {
            document.removeEventListener('keydown', handleKeyPress);
            modalImg.removeEventListener('touchstart', handleTouchStart);
            modalImg.removeEventListener('touchmove', handleTouchMove);
            modalImg.removeEventListener('touchend', handleTouchEnd);
        }

        // Attach event listener to overlay for closing all popups/modal
        document.addEventListener('DOMContentLoaded', () => {
            if (overlay) {
                overlay.addEventListener('click', closeAllPopups);
            }
            // Ensure modal nav buttons have event listeners (initially hidden)
            if (modalPrevBtn) modalPrevBtn.addEventListener('click', showPrevImage);
            if (modalNextBtn) modalNextBtn.addEventListener('click', showNextImage);
        });

    </script>

</body>
</html>
